@model StockItemListModel
@{
	ViewData["Title"] = "Index";
}

@section Styles
{
	<link rel="stylesheet" href="~/adminlte/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
	<link rel="stylesheet" href="~/adminlte/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
	<link rel="stylesheet" href="~/adminlte/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">

	<link rel="stylesheet" href="~/css/custom.css" />


	<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

}

@section Scripts
{
	<script src="~/adminlte/plugins/datatables/jquery.dataTables.min.js"></script>
	<script src="~/adminlte/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
	<script src="~/adminlte/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
	<script src="~/adminlte/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
	<script src="~/adminlte/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
	<script src="~/adminlte/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
	<script src="~/adminlte/plugins/jszip/jszip.min.js"></script>
	<script src="~/adminlte/plugins/pdfmake/pdfmake.min.js"></script>
	<script src="~/adminlte/plugins/pdfmake/vfs_fonts.js"></script>
	<script src="~/adminlte/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
	<script src="~/adminlte/plugins/datatables-buttons/js/buttons.print.min.js"></script>
	<script src="~/adminlte/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

	<script>
		var table;
		$(function () {
			table = $("#stockItems").DataTable({
				processing: true,
				serverSide: true,
				responsive: true,
				searching: false,
				lengthChange: true,
				autoWidth: false,
				lengthMenu: [
					[10, 25, 50, -1],
					[10, 25, 50, 'All']
				],
				ajax: {
					url: "/Admin/StockItem/GetStockItemJsonData",
					type: "POST",
					contentType: "application/json",
					dataType: "json",
					data: function (d) {
						// Ensure you are passing the correct properties for the search
						d.SearchStockItem = {
							ItemName: $("#SearchStockItem_ItemName").val(),
							Barcode: $("#SearchStockItem_Barcode").val(),
							CategoryId: $("#SearchStockItem_CategoryId").val(),
							WarehouseId: $("#SearchStockItem_WarehouseId").val()
						};
						return JSON.stringify(d); // Send the correct data structure
					},
					error: function (xhr, error, thrown) {
						toastr.error("Error fetching stock items. Please try again.");
					}
				},
				columnDefs: [
					{
						orderable: false,
						targets: 5,
						render: function (data, type, row) {
							return `
												<div class="dropdown text-right">
													<a href="#" id="actionMenu${row.ItemId}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="action-menu-icon">
														<i class="fas fa-ellipsis-v"></i>
													</a>
													<div class="dropdown-menu dropdown-menu-right" aria-labelledby="actionMenu${row.ItemId}">
														<a class="dropdown-item" href="/admin/stock/showSerial/${row.ItemId}">
															<i class="fas fa-eye"></i> View Serial
														</a>
													</div>
												</div>
											`;
						}
					}
				],

				dom: '<"top"f>rt<"bottom"il><"clear">',
				language: {
					lengthMenu: "Items per page: _MENU_"
				},
				infoCallback: function (settings, start, end, max, total, pre) {
					return `Total Items: ${total}`;
				},
				ordering: true,
				order: [], // No default order

			});
		});

		// Event listener for input changes
		$("#SearchStockItem_ItemName, #SearchStockItem_Barcode, #SearchStockItem_CategoryId, #SearchStockItem_WarehouseId").on('keyup change', function () {

			table.ajax.reload(null, false); // Reload the table without resetting the paging

		});
	</script>

}


<section class="content-header">
	<div class="container-fluid">
		<div class="row mb-2">
			<div class="col-sm-6">
				<h4>Stock List</h4>
			</div>
		</div>
	</div><!-- /.container-fluid -->
</section>
<!-- Main content -->
<section class="content">
	<div class="card card-info">
		<div class="card-body">
			<div class="row">
				<div class="col-sm-3">
					<div class="form-group">
						<input type="text" asp-for="SearchStockItem.ItemName" class="form-control" placeholder="Item Name" />
					</div>
				</div>
				<div class="col-sm-3">
					<div class="form-group">
						<input type="text" asp-for="SearchStockItem.Barcode" class="form-control" placeholder="Barcode" />
					</div>
				</div>
				<div class="col-sm-6">
					<div class="form-group">
						<select asp-for="SearchStockItem.CategoryId" asp-items="Model.Categories" class="form-control">
							<option value="">Select Category</option>
						</select>

					</div>
				</div>
				<div class="col-sm-3">
					<div class="form-group">
						<select asp-for="SearchStockItem.WarehouseId" asp-items="Model.Warehouses" class="form-control">
							<option value="">Select Warehouse</option> <!-- Placeholder for the dropdown -->
						</select>
					</div>
				</div>

			</div>
		</div>

		<table id="stockItems" class="table table-bordered table-striped custom-table">
			<thead>
				<tr>
					<th>Item</th>
					<th>Barcode</th>
					<th>Warehouse</th>
					<th>In Hand</th> <!-- Quantity -->
					<th>Weighted Avg Cost</th>
					<th class="text-right">Action</th> <!-- Action column aligned right -->
				</tr>
			</thead>
			<tbody>
				<!-- Table rows will be dynamically generated by the DataTable AJAX call -->
			</tbody>
		</table>
	</div>
</section>




